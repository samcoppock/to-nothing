<!DOCTYPE html>
<html>
	<script src="libs\GreenSock-JS\src\minified\TweenMax.min.js"></script>
	<script src="libs\jquery\jquery-3.2.1.min.js"></script>

	<style>
	.row{
		display:block;
		background-color:green;
		position:relative;
	}

	</style>
<body>

<p>Image to use:</p>

<div id="me">
<img id="scream" width="220" height="277" src="imgs/img_the_scream.jpg" alt="The Scream">
</div>

<div>
<img id="pickles" src="imgs/pickles.jpg" alt="The cute one">
</div>

</body>

<script>
window.onload = function() {
	
	$('img').on("click",null,function(){
		genie.splitImage( event );
	});

	var genie = {
	
		settings:{
			rowHeight:1,
			firstStageSpeed:0.5
		},
		
		containerDiv : null,
		height : null,
		width : null,
		
		splitImage : function( e ){

			height = e.target.height;
			width = e.target.width;
			containerDiv = $(e.target).parent();
			var imageSrc = e.target.src;
			
			var rows = height / this.settings.rowHeight;
			var htm = '';
			var i = 0;
			
			for(;i<rows; i++){
				htm += '<div class="row row_' + i + '" style="width:' + width + 'px; height: ' + this.settings.rowHeight + 'px; background-image:url(' + imageSrc + '); background-position: 0px -' + i*this.settings.rowHeight + 'px"></div>'
			}
			
			$(containerDiv).html(htm);
			
			this.colapse();
		
		},
	
		colapse : function() {
		
			var b = $(containerDiv).children();
			var len = b.length;
			var i = len -1; 
			var startTime = 0;
			
			var masterTimeLine = new TimelineMax();
			masterTimeLine.pause();
			
			//timeLine.staggerTo(b, 1, {scaleX:0.5, transformOrigin:"50 50"},0.005);
			
			//Generate the squeezing effect
			var squezeTimeLine = new TimelineMax();
			masterTimeLine.add(squezeTimeLine);
			
			
			for(;i>=0; i--){
				console.log("tween");
				startTime = startTime + 0.002;
				squezeTimeLine.add( TweenLite.to(b[i], this.settings.firstStageSpeed, {scaleX:0.1, transformOrigin:"50 50"}),startTime );
				console.log(i);
			}
			
			var HorizontalMoveTimeLine = new TimelineMax();
			masterTimeLine.add(HorizontalMoveTimeLine,0.5);
			
			//Generate Horizontal movement
			i = len -1;
			startTime = 0;
			
			for(;i>=0; i--){
				startTime = startTime + 0.002;
				HorizontalMoveTimeLine.add( TweenLite.to(b[i], this.settings.firstStageSpeed, {left:200, transformOrigin:"50 50"}),startTime );
			}
			
			masterTimeLine.play();
		}
	}


}
</script>

</html>